jQuery(document).ready(function(a){"use strict";a(window).load(function(){function b(){var b=a("#new-task-item").val(),d=a("#new-task-description").val(),e=new j,f=a(".task-title-field-section"),g=f.find(".notification-ui");""!==b?(e.set({title:b,description:d}),e.save({success:function(a,b){g.html('<p class="message error">Shit</p>').fadeIn(500).fadeOut(2e3)}}),v.fetch({success:function(a,b){c()}}),t.add(e),a("#new-task-item").val(""),a("#new-task-description").val(""),g.html('<p class="message success">You had successfully added a task.</p>').fadeIn(500).fadeOut(2e3),a("#tasks-list").find(".task-list-empty").remove()):g.html('<p class="message error">Task has no title, the field requires a title.</p>').fadeIn(500).fadeOut(2e3)}function c(){h=d(v).attributes.page,g=f+"?page="+h,t.url=g,v.url=g,t.fetch(),v.fetch()}function d(a){if("object"==typeof a||"array"==typeof a)return a.slice(-1)[0]}var e=1,f="RestAPI/tasks.php",g="",h="",i="",j=Backbone.Model.extend({url:function(){return this.id?f+"?id="+this.id:f},defaults:{id:this.id,title:this.title,description:this.description,status:0,position:this.position,error:this.error}}),k=Backbone.Model.extend({url:function(){return e?f+"?page="+e:f},defaults:{page:e,classlist:this.classlist,link:this.link,title:this.title,label:this.label}}),l=Backbone.Model.extend({url:function(){return e?f+"?page="+e:f},defaults:{page:this.page}}),m=Backbone.Collection.extend({model:j,url:f,parse:function(a){return a.tasks}}),n=Backbone.Collection.extend({model:k,url:f,parse:function(a){return i=a.last_pagination,a.pagination}}),o=(Backbone.Collection.extend({model:l,url:f,parse:function(a){return a.last_pagination}}),Backbone.View.extend({tagName:"li",attributes:function(){return{"data-position":this.model.get("position")}},className:function(){var a=this.model.get("status"),b=this.model.get("error"),c="task-item";return 1==a&&(c+=" completed"),"undefined"!=typeof b&&(c+=" task-list-empty"),c},events:{"click .task-status-checkbox":"taskUpdateStatus","click .open-task":"openTask","click .save-changes":"taskUpdateTitle","click .delete-task":"taskDestroy"},openTask:function(b){b.preventDefault(),a("#task-display-handler").show(),a("#task-list-handler").hide(),a("#task-display-handler").html(this.renderSingle())},taskUpdateStatus:function(a){this.model.set("status",0==this.model.get("status")?1:0),Backbone.sync("update",this.model)},taskUpdateTitle:function(a){a.preventDefault();var b=this.$el.find(".task-edit").text();this.model.set("title",b),Backbone.sync("update",this.model)},taskDestroy:function(a){a.preventDefault(),this.model.destroy(),Backbone.sync("delete",this.model)},template:_.template(a("#tasks-template").html()),singleTemplate:_.template(a("#task-template").html()),render:function(){return this.$el.html(this.template(this.model.attributes))},renderSingle:function(){return this.singleTemplate(this.model.attributes)}})),p=Backbone.View.extend({initialize:function(){this.collection.on("add remove",this.render,this),this.collection.on("remove",this.remove,this)},tagName:"ul",render:function(){a("#tasks-list").children().detach(),a("#tasks-list").append(this.collection.map(function(a){return new o({model:a}).render()}))}}),q=Backbone.View.extend({tagName:"li",className:function(){var a=this.model.get("classlist");return a},events:{"click .pagination-link":"fetchData"},fetchData:function(a){a.preventDefault(),e=this.model.get("page")},template:_.template(a("#pagination-template").html()),render:function(){var a=this.model.attributes;return this.$el.html(this.template(a))}}),r=Backbone.View.extend({initialize:function(){this.collection.on("add remove",this.render,this),this.collection.on("remove",this.remove,this)},tagName:"ul",render:function(){a("#tasks-pagination").children().detach(),a("#tasks-pagination").append(this.collection.map(function(a){return new q({model:a}).render()}))}}),s=Backbone.View.extend({initialize:function(){this.collection.on("add remove",this.render,this),this.collection.on("remove",this.remove,this)},render:function(){this.collection.map(function(a){return new q({model:a}).render()})}}),t=new m,u=(new p({collection:t}),500),v=new n,w=(new r({collection:v}),new l);new s({collection:w});a(".item-list").append('<span class="loading"></span>'),setTimeout(function(){t.fetch(),v.fetch()},u),a(document).on("click",".pagination-link",function(){var a=f+"?page="+e;t.url=a,v.url=a,t.fetch(),v.fetch()}),a("#new-task-btn").on("click",function(a){a.preventDefault(),b()}),a("#new-task-item").on("keypress",function(a){13==a.keyCode&&b()}),a(document).on("click",".edit-task",function(b){b.preventDefault();var c=a(this),d=a(this).find(".task-icon"),e=c.parents(".task-item").find(".task-edit");e.attr("task-id"),e.text(),new j;e.hasClass("update-task")?(d.text("create"),c.attr("data-label","Edit"),c.removeClass("save-changes"),e.removeClass("update-task"),e.attr("contenteditable","false")):(d.text("check"),c.attr("data-label","Update"),c.addClass("save-changes"),e.addClass("update-task"),e.attr("contenteditable","true"),e.focus())}),a(document).on("click",".update-task",function(a){a.preventDefault()}),a(document).on("click",".task-status-checkbox",function(b){var c=a(this).attr("checked");"checked"==c?a(this).parents(".task-item").addClass("completed"):a(this).parents(".task-item").removeClass("completed")}),a(document).on("click",".delete-task",function(){v.fetch({success:function(a,b){c()}})}),a(document).on("click","#back-to-task-list",function(b){b.preventDefault(),a("#task-display-handler").html("").hide(),a("#task-list-handler").show()}),a(function(){a("#tasks-list").sortable({start:function(a,b){},axis:"y",stop:function(b,c){a.each(a("#tasks-list li"),function(b,c){a(this).attr("data-position",b)})},update:function(b,c){console.log(b);c.item.index(),a(c.item).attr("data-position")}}),a("#tasks-list").disableSelection()}),a(document).click(function(b){a(b.target).closest(".edit-task").length,!a(b.target).closest(".edit-task").length})})});
//# sourceMappingURL=scripts.min.js.map